pipeline {
    agent any
        parameters{ 

          string(name: 'version', defaultValue: '39ab771af3452b29d32afcaec02d331071b71418', description: 'commit number')

        }

    stages {
        stage('Build') {
            steps {
                 sh " git checkout ${params.version}"
                 sh "docker build --tag=node-app  ."
            }
        }
        stage('push') {
            steps {
                 withCredentials([usernamePassword(credentialsId: 'docker', passwordVariable: 'DOCKER_REGISTRY_PWD', usernameVariable: 'DOCKER_REGISTRY_USER')]) {
                  sh 'docker login -u=$DOCKER_REGISTRY_USER -p=$DOCKER_REGISTRY_PWD'
                  sh 'docker tag node-app samargooda/node_project:latest'
                  sh "docker push samargooda/node_project:latest"
        }
    }
  }
 }
}
